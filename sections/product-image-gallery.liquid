{% schema %}
  {
    "name": "Product Media Gallery",
    "settings": [
      {
        "type": "checkbox",
        "id": "enable_full_width",
        "label": "Full Width Gallery",
        "default": false
      }
    ],
    "presets": [
      {
        "name": "Product Media Gallery",
        "category": "Product"
      }
    ]
  }
  {% endschema %}
  
  {% liquid
    # Ensure we are working with all product media
    assign product_media = product.media
  %}
  
  <div
    class="product-gallery {% if section.settings.enable_full_width %}product-gallery--full-width{% endif %}"
    data-section-id="{{ section.id }}"
  >
    {% if product_media.size > 0 %}
      <div class="product-gallery__images-container">
        <div class="product-gallery__images">
          {% for media in product_media %}
            <div class="product-gallery__image-wrapper" data-image-index="{{ forloop.index0 }}">
              {% case media.media_type %}
                {% when 'image' %}
                  {{ media | image_url: width: 640, height: 460 | image_tag: 
                    class: 'product-gallery__image', 
                    loading: 'lazy', 
                    alt: media.alt | escape 
                  }}
                {% when 'video' %}
                  {{ media | video_tag: 
                    class: 'product-gallery__image',
                    controls: true,
                    poster: media.preview_image | image_url: width: 640, height: 460
                  }}
                {% when 'external_video' %}
                  {{ media | external_video_tag: 
                    class: 'product-gallery__image',
                    loading: 'lazy'
                  }}
                {% when '3d' %}
                  {{ media | model_viewer_tag: 
                    class: 'product-gallery__image',
                    alt: media.alt | escape
                  }}
              {% endcase %}
            </div>
          {% endfor %}
        </div>
  
        {% if product_media.size > 1 %}
          <div class="product-gallery__pagination">
            {% for media in product_media %}
              <div
                class="product-gallery__pagination-dot {% if forloop.first %}active{% endif %}"
                data-slide="{{ forloop.index0 }}"
              ></div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% else %}
      <div class="product-gallery__no-images">
        <p>No product media available.</p>
      </div>
    {% endif %}
  </div>
  
  {% stylesheet %}
    .product-gallery {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
    }
  
    .product-gallery--full-width {
      max-width: 100%;
    }
  
    .product-gallery__images-container {
      position: relative;
      width: 100%;
    }
  
    .product-gallery__images {
      display: flex;
      overflow: hidden;
      width: 100%;
      transition: transform 0.3s ease;
    }
  
    .product-gallery__image-wrapper {
      flex: 0 0 100%;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  
    .product-gallery__image {
      max-width: 640px;
      max-height: 460px;
      width: 100%;
      height: auto;
      object-fit: contain;
    }
  
    .product-gallery__pagination {
      display: flex;
      justify-content: center;
      margin-top: 15px;
    }
  
    .product-gallery__pagination-dot {
      width: 60px;
      height: 4px;
      background-color: #e0e0e0;
      margin: 0 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
  
    .product-gallery__pagination-dot.active {
      background-color: #333;
    }
  
    .product-gallery__no-images {
      text-align: center;
      padding: 20px;
      color: #888;
    }
  
    @media screen and (max-width: 768px) {
      .product-gallery__image {
        max-width: 100%;
        max-height: none;
      }
    }
  {% endstylesheet %}
  
  {% javascript %}
    document.addEventListener('DOMContentLoaded', function () {
      const gallery = document.querySelector('.product-gallery__images');
      const paginationDots = document.querySelectorAll('.product-gallery__pagination-dot');
  
      if (paginationDots.length > 0) {
        paginationDots.forEach((dot, index) => {
          dot.addEventListener('click', () => {
            // Remove active class from all dots
            paginationDots.forEach((d) => d.classList.remove('active'));
  
            // Add active class to clicked dot
            dot.classList.add('active');
  
            // Move gallery to selected image
            gallery.style.transform = `translateX(-${index * 100}%)`;
          });
        });
      }
    });
  {% endjavascript %}